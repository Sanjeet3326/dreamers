<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Activity Log</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .admin-container{max-width:1100px;margin:40px auto;padding:20px;background:rgba(255,255,255,0.95);border-radius:12px;color:#111}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid #eee;text-align:left;font-size:0.95rem}
    .controls{display:flex;gap:10px;justify-content:flex-end;margin-bottom:12px}
    pre{white-space:pre-wrap;font-size:0.9rem}
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>Admin — Activity Log</h1>
    <div class="controls">
      <button id="refresh-log">Refresh</button>
      <button id="export-log">Export JSON</button>
      <button id="clear-log">Clear Log</button>
    </div>
    <div id="log-stats"></div>
    <table id="activity-table">
      <thead><tr><th>Time</th><th>User</th><th>Type</th><th>Details</th></tr></thead>
      <tbody></tbody>
    </table>
    <h3>Raw JSON</h3>
    <pre id="raw-json"></pre>
  </div>
  <script>
    function loadLog(){
      const log = JSON.parse(localStorage.getItem('dreamer_activity_log')||'[]');
      const tbody = document.querySelector('#activity-table tbody');
      tbody.innerHTML = '';
      log.forEach(entry=>{
        const tr = document.createElement('tr');
        const t = new Date(entry.ts).toLocaleString();
        tr.innerHTML = `<td>${t}</td><td>${entry.user||'-'}</td><td>${entry.type}</td><td>${JSON.stringify(entry.details)}</td>`;
        tbody.appendChild(tr);
      });
      document.getElementById('raw-json').textContent = JSON.stringify(log, null, 2);
      document.getElementById('log-stats').textContent = `Entries: ${log.length}`;
    }
    document.getElementById('refresh-log').addEventListener('click', loadLog);
    document.getElementById('export-log').addEventListener('click', ()=>{
      const raw = localStorage.getItem('dreamer_activity_log') || '[]';
      const blob = new Blob([raw], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'activity-log-'+new Date().toISOString().slice(0,10)+'.json';
      document.body.appendChild(a); a.click(); a.remove();
    });
    document.getElementById('clear-log').addEventListener('click', ()=>{
      if(confirm('Clear all activity logs?')){ localStorage.removeItem('dreamer_activity_log'); loadLog(); }
    });
    loadLog();
  </script>
</body>
</html>
